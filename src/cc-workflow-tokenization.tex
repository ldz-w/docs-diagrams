% Preamble
\documentclass[tikz,border=12pt,12pt]{standalone}
\input{style/sequence.tikz}
\input{vars/shortcuts.tex}

\begin{document}
\begin{tikzpicture}

% Body
  % Participants
  \node[pt2] at (0,1.5) {Consumer};
  	\node[icon] (icon1) at (0,3)
       {\includegraphics[width=.1\textwidth]{useralt.png}};
   \node[pt1] at (15,1.5) {Merchant};
       \node[icon] (icon2) at (15,3)
            {\includegraphics[width=.1\textwidth]{retailers.png}};
    \node[pt3] at (30,2) {\wdpaymentgateway};
       \node[icon] (icon3) at (30,3)
            {\includegraphics[width=.1\textwidth]{gear.png}};

                      
 			 % Aid Lines
 			\draw[line_night] (0,0) -- (0,-10);
  			\draw[line_mulberry] (15,0) -- (15,-10);
 			\draw[line_nightsky] (30,0) -- (30,-10);
  
                      % Nodes
                      \fill[night] (-0.1,-0.9) rectangle (0.1,-6.5);
                      \fill[mulberry] (14.9,-3.4) rectangle (15.1,-4.1);
                      \fill[nightsky] (29.9,-3.9) rectangle (30.1,-8.1);
                      \fill[mulberry] (14.9,-7.9) rectangle (15.1,-10.6);

                      % Arrows & Text
                      \draw[solidarrow, txt]
                      	(0.2,-1) -- (0.4,-1) -- node[midway,right] {1.1 Selects Payment Method \\ "Credit Card"} (0.4,-2.5) -- (0.2,-2.5);
                      \draw[solidarrow, txt]
				(0.2,-3.5) -- node[midway,above] {1.2 Uses credit card for the first time} (14.8,-3.5);
                     \draw[solidarrow, txt]
				(0.2,-3.5) -- node[midway,below] {\texttt{<card>} tag contains: \\ \texttt{<account-number> \\ <expiration-month> \\ <expiration-year> \\ <card-security-code> \\ <card-type>}} (14.8,-3.5);
					\draw[gray, dashed]
                     			(3.2,-3.5) -- (3.2,-6.5);
                      \draw[solidarrow, txt]
				(15.2,-4) -- node[midway,above] {2 Sends Authorization Request} (29.8,-4);
                      \draw[solidarrow, txt]
				(30.2,-4) -- (30.4,-4) -- node[midway,right] {3.1 Receives Authorization Request} (30.4,-5.5) -- (30.2,-5.5);
                      \draw[solidarrow, txt]
				(30.2,-6.5) -- (30.4,-6.5) -- node[midway,right] {3.2 Creates \texttt{<token-id>}} (30.4,-8) -- (30.2,-8);
                      \draw[solidarrow, txt]
				(29.8,-8) -- node[midway,above] {3.4 Sends Authorization Response \\ containing \texttt{<card-token>} tag} (15.2,-8);
                      \draw[solidarrow, txt]
				(15.2,-9) -- (15.4,-9) -- node[midway,right] {4 Stores \texttt{<card-token>} data for reuse with the corresponding credit card} (15.4,-10.5) -- (15.2,-10.5);

\end{tikzpicture}
\end{document}
