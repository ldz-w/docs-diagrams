\documentclass[tikz,border=12pt,12pt]{standalone}
\input{style/new_sequence.tikz}
\input{vars/shortcuts.tex}

\begin{document}
\begin{tikzpicture}
  	
    	\node[merchant] at (0,1.5) {Merchant};
    		\node[inner sep=0pt] (icon1) at (0,3)
		{\includegraphics[width=.1\textwidth]{merchant.png}};
    	\node[paymentgateway] at (10,1.5) {Payment Gateway};
		\node[inner sep=0pt] (icon2) at (10,3)
		{\includegraphics[width=.1\textwidth]{paymentgateway.png}};
    	\node[paymentprovider] at (20,1.5) {Payment Provider};
		\node[inner sep=0pt] (icon3) at (20,3)
		{\includegraphics[width=.1\textwidth]{bigdata.png}};

	\draw[aidline] (0,0) -- (0,-20);
	\draw[aidline] (10,0) -- (10,-20);
	\draw[aidline] (20,0) -- (20,-20);
    	
    	% Nodes

    	
    	\draw[solidarrow]
    		(-4.8,-1) -- node[midway,above] {Multipayment Request} (9.8,-1);
    	\draw[solidarrow, txt]
    		(10.2,-1) -- (10.4,-1) -- node[midway,right] {Validate payment request} (10.4,-2.5) -- (10.2,-2.5);
    	\draw[solidarrow, txt]
    		(10.2,-3) -- (10.4,-3) -- node[midway,right] {Generate single payment request \\ for each payment method} (10.4,-4.5) -- (10.2,-4.5);
    	\draw[solidarrow, txt]
    		(10.2,-6.1) -- node[midway,above] {Send request for single payment method} (24.8,-6.1);
    	\draw[solidarrow, txt]
    		(25.2,-6.1) -- (25.4,-6.1) -- node[midway,right] {Process payment request} (25.4,-7.6) -- (25.2,-7.6);
    	\draw[solidarrow, txt]
    		(25.2,-8.1) -- (25.4,-8.1) -- node[midway,right] {Send payment response} (25.4,-9.6) -- (25.2,-9.6);
      	\draw[solidarrow, txt]
    		(24.6,-9.1) -- node[midway,above] {Payment successful} (10.2,-9.1);
    	\draw[solidarrow, txt]
    		(24.6,-10.1) -- node[midway,above] {Payment failed} (10.4,-10.1);
  
    	\draw[solidarrow, txt]
    		(10.4,-13.1) -- node[midway,above] {Rollback previously successful \\ payment transaction} (24.8,-13.1);
    			\draw[solidarrow, txt]
    				(25.2,-13.1) -- (25.4,-13.1) -- node[midway,right] {Cancel previous \\ payment transaction} (25.4,-19.2) -- (25.2,-19.2);
    			\draw[solidarrow, txt]
    				(24.8,-19.2) -- node[midway,above] { } (10.2,-19.2);
    	\draw[solidarrow, txt]
    		(10.2,-14.1) -- (10.4,-14.1) -- node[midway,right] {Pending Payment Request?} (10.4,-15.6) -- (10.2,-15.6);
    			\draw[solidarrow]
    				(9.8,-15.6) -- (9.6,-15.6) -- node[left] {Yes (1 to n)} (9.6,-6.1) -- (9.8,-6.1);
    			\draw[solidarrow, txt]
    				(10.2,-15.7) -- (10.4,-15.7) -- node[midway, right] {No} (10.4,-17.2) -- (10.2,-17.2);
    	\draw[solidarrow, txt]
    		(10.2,-17.7) -- (10.4,-17.7) -- node[midway,right] {Build Response} (10.4,-19.2) -- (10.2,-19.2);
    	\draw[solidarrow, txt]
    		(9.8,-19.2) -- node[midway,above] {Multipayment Response} (-4.8,-19.2);
    		
\end{tikzpicture}
\end{document}